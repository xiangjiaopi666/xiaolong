<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>链式 TXT 下载（序号在日期后）</title>
</head>
<body>

日期：<input id="dateDiv" readonly><br>
时间：<input id="timeDiv" readonly><br>
厅号：<input id="hallDiv" value="3厅"><br><br>

<button onclick="downloadNext()">下载下一个文件</button>

<script>
let index = 1;          // [1][2][3] 序号
let lastFileName = ""; // 上一个文件名
let lastContent = "";  // 上一个文件内容

function pad(n) {
  return n.toString().padStart(2, "0");
}

function getCurrentDate() {
  const d = new Date();
  return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
}

function getCurrentTimeWithMs() {
  const d = new Date();
  return (
    pad(d.getHours()) + "-" +
    pad(d.getMinutes()) + "-" +
    pad(d.getSeconds()) + "-" +
    d.getMilliseconds()
  );
}

function download(name, content) {
  const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name + ".txt";
  a.click();
  URL.revokeObjectURL(a.href);
}

function downloadNext() {
  dateDiv.value = getCurrentDate();
  timeDiv.value = getCurrentTimeWithMs();

  // ⭐ 序号放在日期后面
  const currentFileName =
    dateDiv.value + "_[" + index + "]_" +
    timeDiv.value + "_" +
    hallDiv.value;

  let currentContent;
  if (index === 1) {
    // 第一个文件：内容为空
    currentContent = "";
  } else {
    // 链式规则（换行）
    currentContent = lastFileName + "\n" + lastContent;
  }

  download(currentFileName, currentContent);

  lastFileName = currentFileName;
  lastContent = currentContent;
  index++;
}

// 初始化
dateDiv.value = getCurrentDate();
timeDiv.value = getCurrentTimeWithMs();
</script>

</body>
</html>
