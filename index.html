<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="logo.png" type="image/x-icon">
		<style>
			#printFrame {
				display: none;
				/* éšè—iframe */
				width: 0;
				/* åˆå§‹å®½åº¦è®¾ç½®ä¸º0ï¼Œä»¥é¿å…é¡µé¢å¸ƒå±€å˜åŒ– */
				height: 0;
				/* åˆå§‹é«˜åº¦è®¾ç½®ä¸º0 */
			}

			#alltable {
				display: none;
			}

			#NO3 {
				display: none;
			}

			/* æ‰“å°æ ·å¼ */
			@media print {
				body * {
					visibility: hidden;
					/* éšè—é¡µé¢ä¸Šæ‰€æœ‰å†…å®¹ */
				}

				#printArea,
				#printArea * {
					visibility: visible;
					/* ä»…æ˜¾ç¤ºè¦æ‰“å°çš„divåŠå…¶å†…å®¹ */
					position: static;
					/* é‡ç½®ä½ç½®å±æ€§ï¼Œé¿å…æ‰“å°é—®é¢˜ */
					page-break-after: auto;
					/* æ§åˆ¶åˆ†é¡µ */
				}

				@page {
					margin: 0mm;
					/* è®¾ç½®é¡µè¾¹è·ä¸º0 */
					size: auto;
					/* è‡ªåŠ¨é€‚åº”å†…å®¹å¤§å° */
				}
			}

			#biao {
				position: fixed;
				top: 10px;
				right: 10px;
				background-color: white;
				z-index: 1000;
				padding: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				border-radius: 5px;
			}

			table {
				border-collapse: collapse;
				width: 100%;
			}

			th,
			td {
				padding: 8px;
				text-align: center;
			}

			td:first-child {
				max-width: 200px;
				/* è®¾ç½®æœ€å¤§å®½åº¦ */
				white-space: nowrap;
				/* ç¦æ­¢æ¢è¡Œ */
				overflow: hidden;
				/* è¶…å‡ºéƒ¨åˆ†éšè— */
				text-overflow: ellipsis;
				/* ä½¿ç”¨çœç•¥å·éšè—è¶…å‡ºéƒ¨åˆ† */
			}
		</style>
		<style>
			/* åªä½œç”¨äºå½“å‰ä»£ç ç”Ÿæˆçš„è¡¨æ ¼ */
			#movieTasks {
				border-collapse: collapse;
				width: 882px;
				margin-bottom: 10px;
			}

			#movieTasks th,
			#movieTasks td {
				border: 1px solid #ccc;
				padding: 8px;
				text-align: center;
			}

			#movieTasks th {
				background-color: #f0f0f0;
			}

			#movieTasks input {
				width: 80px;
				text-align: center;
			}

			#movieTasks .error-row {
				background-color: #ffcccc;
			}

			#finalConfirm {
				padding: 8px 15px;
				font-size: 16px;
			}
		</style>
		<title>æ’æœŸ</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<script src="xlsx.full.min.js"></script>
		<script src="qrcode.min.js"></script>
		<script>
			//å€’è®¡æ—¶è½¯ä»¶ç”¨
			function calculateSecondsDifference(date1String, date2String) {
				const date1 = new Date(date1String);
				const date2 = new Date(date2String);
				const diffInMilliseconds = Math.abs(date1 - date2);
				const diffInSeconds = Math.ceil(diffInMilliseconds / 1000);
				return diffInSeconds;
			}
			const date1 = "";
			const date2 = "1950-01-01T00:00:00";
			//const secondsDifference = calculateSecondsDifference(date1, date2);
			//è§£æ
			let movies = []; //Excelè¡¨ä¸­è·å–çš„jsonæ ¼å¼çš„å½±ç‰‡ä¿¡æ¯
			function getMovies_timejson(movies_timejson) { //è·å–é¢„è®¾çš„jsonæ ¼å¼å½±ç‰‡ä¿¡æ¯
				movies = movies_timejson;
				//console.log(movies);
			}

			var indicesToDelete = []; //é»˜è®¤éœ€è¦åˆ é™¤çš„åœºæ¬¡ä¸ºç©º
			function extractField() {
				document.getElementById('alltable').style.display = 'block';
				yincang(); //éšè—ä¿æ´æ—©æ™šç­div
				//ç§»é™¤é‡å¤ç‚¹å‡»è§£ææ—¶äº§ç”Ÿçš„ä¿®æ”¹æ’­éŸ³å¤§å¸ˆæ’­éŸ³é—´éš”è¡¨æ ¼
				document.getElementById("movieTasks").innerHTML = "";
				//console.log("æå–")
				//æ¸…é™¤è¡¨æ ¼è®°å½•
				let NeedCheck = []; //éœ€è¦ç²¾ç¡®æ—¶é—´çš„ç”µå½±å
				//console.log(movies);
				document.getElementById('tableContainer').innerHTML = '';
				// è·å–è¾“å…¥æ¡†ä¸­çš„JSONå­—ç¬¦ä¸²
				var jsonInput = document.getElementById('json-input').value;
				document.getElementById('start').value = jsonInput;
				// å°è¯•è§£æJSONå­—ç¬¦ä¸²
				try {
					var jsonData = JSON.parse(jsonInput);
					//console.log(jsonData.data.arr_date_plan); //å…¨éƒ¨åœºæ¬¡
					//åˆ é™¤è™šæ‹Ÿåœºæ¬¡
					//let indicesToDelete = [4,3,2,1,0];//è™šæ‹Ÿåœºæ¬¡çš„åºå·
					//console.log('åˆ é™¤äº† ' + indicesToDelete + 'åœº');
					// ä»åå¾€å‰åˆ é™¤å…ƒç´ 
					indicesToDelete.sort((a, b) => b - a).forEach(index => {
						jsonData.data.arr_date_plan.splice(index, 1);
					});
					indicesToDelete = []; //åˆ é™¤åæ¸…ç©ºåˆ é™¤è®°å½•ï¼Œé˜²æ­¢å¤šåˆ 
					//console.log(JSON.stringify(jsonData.data.arr_date_plan, null, 2));
					//console.log(jsonData.data.arr_date_plan)//å»é™¤åçš„åœºæ¬¡
					document.getElementById('json-input').value = '{"data":{"arr_date_plan":' + JSON.stringify(jsonData.data
						.arr_date_plan, null, 0) + '}}';
					//console.log(document.getElementById('json-input').value);
					//console.log(JSON.stringify(jsonData.data.arr_date_plan, null, 0))
					var table = document.createElement('table');
					table.style.borderCollapse = 'collapse';
					table.style.fontSize = 'smaller';
					table.id = 'tableContainer_div';
					//table.style.width = '100%';

					// åˆ›å»ºè¡¨å¤´
					var thead = document.createElement('thead');
					var headerRow = document.createElement('tr');
					['å¼€å§‹', 'ç»“æŸ', 'ç”µå½±', 'å½±å…', 'X'].forEach(function(text) {
						var th = document.createElement('th');
						th.textContent = text;
						th.style.border = '1px solid black';
						th.style.padding = '2px';
						headerRow.appendChild(th);
					});
					thead.appendChild(headerRow);
					table.appendChild(thead);

					// åˆ›å»ºè¡¨æ ¼ä½“
					var tbody = document.createElement('tbody');
					var Plan_yes = 0; //å®¡æ ¸é€šè¿‡(é‡Šæ”¾)
					var Plan_no = 0; //æœªå®¡æ ¸(æš‚åœ)
					var sale_status_sale = 0; //æ­£å¸¸å”®å–
					var sale_status_stop = 0; //æš‚åœåœºæ¬¡
					for (var i = 0; i < jsonData.data.arr_date_plan.length; i++) {
						var rowData = jsonData.data.arr_date_plan[i];
						//console.log(jsonData.data.arr_date_plan[i].approve_status);
						if (jsonData.data.arr_date_plan[i].approve_status == 'APPROVED') {
							Plan_yes++; //ç»Ÿè®¡é‡Šæ”¾åœºæ¬¡æ•°é‡
						} else {
							Plan_no++; //ç»Ÿè®¡æœªé‡Šæ”¾åœºæ¬¡æ•°é‡
						}
						if (jsonData.data.arr_date_plan[i].sale_status == 'SALE') {
							sale_status_sale++;
						} else {
							sale_status_stop++;
						}
						//console.log(rowData)
						var row = document.createElement('tr');

						var starttimeCell = document.createElement('td');
						var starttime = rowData.show_time_start;
						starttimeCell.textContent = starttime;
						starttimeCell.style.border = '1px solid black';
						starttimeCell.style.padding = '4px';
						starttimeCell.style.textAlign = 'center';
						row.appendChild(starttimeCell);

						var endtimeCell = document.createElement('td');
						var endtime = rowData.show_time_end;
						endtimeCell.textContent = endtime;
						endtimeCell.style.border = '1px solid black';
						endtimeCell.style.padding = '4px';
						endtimeCell.style.textAlign = 'center';
						row.appendChild(endtimeCell);


						var nameCell = document.createElement('td');

						const replaceMap = [
							['æ™®é€šç«‹ä½“', 'æ™®é€š'],
							['ï¼ˆæ™®é€š/å›½è¯­ï¼‰', ''],
							['ï¼ˆæ™®é€š 2D/å›½è¯­ï¼‰', ''],
							['ï¼ˆæ™®é€š/æ—¥è¯­ï¼‰', 'ï¼ˆæ—¥è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/æ—¥è¯­ï¼‰', 'ï¼ˆæ—¥è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/è‹±è¯­ï¼‰', 'ï¼ˆè‹±è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/è‹±è¯­ï¼‰', 'ï¼ˆè‹±è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/å°åº¦è¯­ï¼‰', 'ï¼ˆå°åº¦è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/å°åº¦è¯­ï¼‰', 'ï¼ˆå°åº¦è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/å°å°¼è¯­ï¼‰', 'ï¼ˆå°å°¼è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/å°å°¼è¯­ï¼‰', 'ï¼ˆå°å°¼è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/æ³•è¯­ï¼‰', 'ï¼ˆæ³•è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/æ³•è¯­ï¼‰', 'ï¼ˆæ³•è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/æ³°è¯­ï¼‰', 'ï¼ˆæ³°è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/æ³°è¯­ï¼‰', 'ï¼ˆæ³°è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/æ„å¤§åˆ©è¯­ï¼‰', 'ï¼ˆæ„å¤§åˆ©è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/æ„å¤§åˆ©è¯­ï¼‰', 'ï¼ˆæ„å¤§åˆ©è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/éŸ©è¯­ï¼‰', 'ï¼ˆéŸ©è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/éŸ©è¯­ï¼‰', 'ï¼ˆéŸ©è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/ä¿„è¯­ï¼‰', 'ï¼ˆä¿„è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/ä¿„è¯­ï¼‰', 'ï¼ˆä¿„è¯­ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š/å…¶ä»–ï¼‰', 'ï¼ˆå…¶ä»–ï¼‰ğŸŒ'],
							['ï¼ˆæ™®é€š 2D/å…¶ä»–ï¼‰', 'ï¼ˆå…¶ä»–ï¼‰ğŸŒ'],
							['ï¼ˆæ•°å­—3Dï¼‰', ' 3DğŸ‘“'],
							['ï¼ˆæ™®é€š 3D/è‹±è¯­ï¼‰', ' 3DğŸ‘“'],
						];

						let result = rowData.display_name;
						for (const [from, to] of replaceMap) {
							result = replaceSpecifiedString(result, from, to);
						}

						nameCell.textContent = result;
						nameCell.style.border = '1px solid black';
						nameCell.style.padding = '4px';
						nameCell.style.textAlign = 'left';
						row.appendChild(nameCell);

						var hallNameCell = document.createElement('td');
						hallNameCell.textContent = rowData.hall_name.slice(0, 1);
						hallNameCell.style.border = '1px solid black';
						hallNameCell.style.padding = '4px';
						hallNameCell.style.textAlign = 'center';
						row.appendChild(hallNameCell);

						var deleteMovie = document.createElement('td');
						const checkbox = document.createElement('input');
						checkbox.type = 'checkbox';
						checkbox.value = i; // è®¾ç½®å€¼ä¸ºè¡Œå·ï¼ˆä»0å¼€å§‹ï¼‰
						deleteMovie.appendChild(checkbox);
						row.appendChild(deleteMovie);

						tbody.appendChild(row);
					}


					table.appendChild(tbody);
					//console.log('é‡Šæ”¾åœºæ¬¡:'+Plan_yes);
					//console.log('æœªé‡Šæ”¾åœºæ¬¡:'+Plan_no);
					// å°†è¡¨æ ¼æ·»åŠ åˆ°ç½‘é¡µä¸­çš„æŒ‡å®šä½ç½®
					document.getElementById('tableContainer').appendChild(table);
					//console.log("å½“å‰æ—¥æœŸç”µå½±æ•°é‡ä¸º:" + jsonData.data.arr_date_plan.length);
					var all = "";
					var wucha_all = "";
					var wucha_start = "";
					var wucha_end = "";
					let wucha_1h_tishi = []; //å¼€ç¯æ—¶é—´æœªç²¾ç¡®ï¼Œ1å°æ—¶åä¸€ç›´å¼¹å‡ºæç¤ºè¦æ›´æ–°
					let moviesData = [];
					var update_time = []; //åœºæ¬¡åˆ›å»ºæ—¶é—´
					//å®šä¹‰æ’­éŸ³å¤§å¸ˆæ•°ç»„
					let TaskID = [],
						TaskTopic = [],
						TaskContent = [],
						BegDate = [],
						BegTime = [],
						EndDate = [],
						EndTime = [];
					var Interval = 6;
					WeekFlag1 = 1, WeekFlag2 = 1, WeekFlag3 = 1, WeekFlag4 = 1, WeekFlag5 = 1, WeekFlag6 = 1, WeekFlag7 = 1,
						DingFlag = 1, VSID = 3, BMID = 0, BCTimes = 0, BCFlag = 0, Timeout = 0, TaskLevel = 1, StopFlag = 0;
					var BYDS_BuBian_all = "\t" + Interval + "\t" + WeekFlag1 + "\t" + WeekFlag2 + "\t" + WeekFlag3 + "\t" +
						WeekFlag4 + "\t" + WeekFlag5 + "\t" + WeekFlag6 + "\t" + WeekFlag7 + "\t" + DingFlag + "\t" + VSID +
						"\t" + BMID + "\t" + BCTimes + "\t" + BCFlag + "\t" + Timeout + "\t" + TaskLevel + "\t" + StopFlag;
					var BYDS_all = "";
					var BYDS_all_json_all = "";
					var BYDS_all_json = [];
					var Suijishu = Math.floor(Math.random() * 10000) + 1;
					for (var i = 0; i < jsonData.data.arr_date_plan.length; i++) {
						var name = jsonData.data.arr_date_plan[i].display_name; //ç”µå½±å+è¯­è¨€+3D
						var name_min = jsonData.data.arr_date_plan[i].movie_alias; //ç”µå½±å
						//æ›¿æ¢æ‰ç”µå½±åä¸­å¯èƒ½å‡ºé—®é¢˜çš„å­—ç¬¦
						name_min = replaceSpecifiedString(name_min, 'ï¼ˆæ•°å­—ï¼‰', '');
						name_min = replaceSpecifiedString(name_min, 'ï¼ˆèˆå°çºªå½•ç”µå½±ï¼‰', '');

						var date = jsonData.data.arr_date_plan[i].plan_date; //2023-01-01
						var time = jsonData.data.arr_date_plan[i].show_time_start; //2023-01-01T00:00:00
						var time_end = jsonData.data.arr_date_plan[i].show_time_end; //2023-01-01T00:00:00
						var time_min = time.slice(11, 16); //00:00
						var dis_version = jsonData.data.arr_date_plan[i].dis_version; //æ™®é€š?æ™®é€šç«‹ä½“?
						var hall_name = jsonData.data.arr_date_plan[i].hall_name;
						var djs_tishi_light_on = "";
						var djs_tishi_dongzuo = "";
						//è®¡ç®—æ’­éŸ³å¤§å¸ˆæé†’æ—¶é—´ï¼Œåº”è¯¥æ¯”ç”µå½±å¼€å§‹æ—¶é—´æå‰10åˆ†é’Ÿæé†’ï¼Œ6åˆ†é’Ÿåå†æ¬¡æé†’
						//let BYtime = "2023-01-01T00:01:00";  

						// å°†æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸ºDateå¯¹è±¡  
						let BYdate = new Date(time);

						// ä»å½“å‰åˆ†é’Ÿæ•°ä¸­å‡å»10åˆ†é’Ÿ  
						BYdate.setMinutes(BYdate.getMinutes() - 10);

						// è·å–æ ¼å¼åŒ–åçš„æ—¶é—´éƒ¨åˆ†  
						let BYyear = BYdate.getFullYear();
						let BYmonth = (BYdate.getMonth() + 1).toString().padStart(2, '0'); // æœˆä»½ä»0å¼€å§‹ï¼ŒåŠ 1åæ ¼å¼åŒ–  
						let BYday = BYdate.getDate().toString().padStart(2, '0');
						let BYhours = BYdate.getHours().toString().padStart(2, '0');
						let BYminutes = BYdate.getMinutes().toString().padStart(2, '0');
						let BYseconds = BYdate.getSeconds().toString().padStart(2, '0');

						// æ‹¼æ¥æˆç›®æ ‡æ ¼å¼çš„å­—ç¬¦ä¸²  
						let newBYTime = `${BYyear}-${BYmonth}-${BYday}T${BYhours}:${BYminutes}:${BYseconds}`;

						//console.log(newBYTime); // è¾“å‡ºç±»ä¼¼ "2023-01-01T00:51:00"ï¼Œè¿™å–å†³äºæœ¬åœ°æ—¶åŒº

						//å»æ‰æ’­éŸ³é‡Œçš„ï¼ˆæ•°å­—3Dï¼‰
						name_min = replaceSpecifiedString(name_min, "ï¼ˆæ•°å­—3Dï¼‰", "")
						//æ ‡è®°3Dç”µå½±
						if (dis_version == "æ™®é€š") {
							dis_version = replaceSpecifiedString(dis_version, "æ™®é€š", "")
							//console.log(dis_version);
						} else if (dis_version == "æ™®é€šç«‹ä½“") {
							dis_version = replaceSpecifiedString(dis_version, "æ™®é€šç«‹ä½“", "3D")
							//console.log(dis_version);
						} else if (dis_version == "æ™®é€š 2D") {
							dis_version = replaceSpecifiedString(dis_version, "æ™®é€š 2D", "")
							//console.log(dis_version);
						} else if (dis_version == "æ™®é€š 3D") {
							dis_version = replaceSpecifiedString(dis_version, "æ™®é€š 3D", "3D")
							//console.log(dis_version);
						}
						//å¢åŠ å€’è®¡æ—¶çš„1å…åŠ¨ä½œæç¤º
						if (hall_name.slice(0, 1) == "1") {
							djs_tishi_dongzuo = "||å¼€å§‹||â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆæ¢åŠ¨ä½œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ";
						} else {
							djs_tishi_dongzuo = "||å¼€å§‹"
						}
						//djs_tishi_dongzuo = replaceSpecifiedString(hall_name.slice(0,1),"1","å¼€å§‹ã€æ¢åŠ¨ä½œã€‘");
						//æ›¿æ¢æ’­éŸ³å¤§å¸ˆå¤šéŸ³å­—ï¼Œè®¡ç®—å®é™…äº®ç¯æ—¶é—´
						const secondsDifference_start = calculateSecondsDifference(time, date2);
						var secondsDifference_end = calculateSecondsDifference(time_end, date2);
						var secondsDifference_end_current = '';
						const result = processMovieString(name_min);
						//console.log(result);
						if (result == null) { //å¼€ç¯æ—¶é—´è¡¨ä¸€ç‚¹ä¿¡æ¯æ²¡æœ‰
							name_min_new = name_min; //æ’­éŸ³å¤§å¸ˆæ— å¤šéŸ³å­—éœ€è¦ä¿®æ”¹
							secondsDifference_end_current = secondsDifference_end;
							djs_tishi_light_on = "ç»“æŸ||è¯·æ›´æ–°å‡†ç¡®æ—¶é—´"
							NeedCheck.push(name_min); //å°†éœ€è¦ç²¾ç¡®æ—¶é—´çš„ç”µå½±åç»™å¯¹åº”æ•°ç»„ï¼Œæ–¹ä¾¿è¾“å‡ºæç¤º
							//console.log(name_min_new + "  æ— ä»»ä½•ä¿¡æ¯");
						} else {
							if (result.nickname == undefined) { //å¦‚æœæ˜µç§°ä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦æ›¿æ¢
								name_min_new = name_min;
							} else {
								name_min_new = result.nickname;
							}
							if (result.lightOnTime == undefined || result.posterTime == undefined || result.lightOnTime == '' ||
								result.posterTime == '') { //å¦‚æœä¸¤ä¸ªæ—¶é—´ä¸å…¨
								secondsDifference_end_current = secondsDifference_end;
								djs_tishi_light_on = "ç»“æŸ||è¯·æ›´æ–°å‡†ç¡®æ—¶é—´";
								NeedCheck.push(name_min);
							} else { //å¦‚æœä¿¡æ¯å…¨éƒ¨å­˜åœ¨
								secondsDifference_end_current = parseInt(secondsDifference_start) + parseInt(result
									.timeDifference) - 60;
								djs_tishi_light_on = "||ä¸€åˆ†é’Ÿåäº®ç¯";
							}
						}
						/*if (result == null || result.lightOnTime == undefined || result.posterTime == undefined) {
							name_min_new = name_min; //æ’­éŸ³å¤§å¸ˆæ— å¤šéŸ³å­—éœ€è¦ä¿®æ”¹
							secondsDifference_end_current = secondsDifference_end;
							djs_tishi_light_on = "ç»“æŸ||è¯·æ›´æ–°å‡†ç¡®æ—¶é—´"
							NeedCheck.push(name_min);
							console.log(name_min_new + "  1");
						} else {
							if (result.nickname == undefined) {
								name_min_new = name_min; //æ’­éŸ³å¤§å¸ˆæ— å¤šéŸ³å­—éœ€è¦ä¿®æ”¹
								secondsDifference_end_current = parseInt(secondsDifference_start) + parseInt(result
									.timeDifference) - 60;
								djs_tishi_light_on = "||â‘ åˆ†åäº®ç¯";
								console.log(name_min_new + "  2");
							} else {
								name_min_new = result.nickname; //æ›¿æ¢å¤šéŸ³å­—
								secondsDifference_end_current = parseInt(secondsDifference_start) + parseInt(result
									.timeDifference) - 60;
								djs_tishi_light_on = "||â‘ åˆ†åäº®ç¯";
								console.log(name_min_new + "  3");
								//console.log(secondsDifference_end_current)
							}
						}*/
						update_time[i] = jsonData.data.arr_date_plan[i].update_time;
						//æ’­éŸ³å¤§å¸ˆæ•°ç»„ä¾æ¬¡èµ‹å€¼
						TaskID[i] = Suijishu + i;
						TaskTopic[i] = name_min;
						//TaskContent[i] = "\=\"æ¬¢è¿å…‰ä¸´äºšæ˜Ÿå°é¾™æ¿€å…‰å½±åŸ \"&CHAR(10)&\"" + hall_name.slice(0,1) + "å·å…" + time_min + "çš„" + dis_version + "ç”µå½±ã€Š" + name_min +"ã€‹ç°åœ¨å¼€å§‹æ£€ç¥¨è¿›åœº \"&CHAR(10)&\"" + hall_name.slice(0,1) + "å·å…" + time_min + "çš„ç”µå½±ã€Š" + name_min +"ã€‹ç°åœ¨å¼€å§‹æ£€ç¥¨è¿›åœº \"&CHAR(10)&\"æœ¬å½±åŸç¦æ­¢å¸çƒŸï¼Œè°¢ç»å¤–å¸¦é£Ÿå“ï¼Œè°¢è°¢æ‚¨çš„é…åˆï¼Œç¥æ‚¨è§‚å½±æ„‰å¿«\"";
						TaskContent[i] = "æ¬¢è¿å…‰ä¸´äºšæ˜Ÿå°é¾™æ¿€å…‰å½±åŸ " + hall_name.slice(0, 1) + "å·å…" + time_min + "çš„" + dis_version + "ç”µå½± ã€Š" +
							name_min_new + "ã€‹ ç°åœ¨å¼€å§‹æ£€ç¥¨è¿›åœº " + hall_name.slice(0, 1) + "å·å…" + time_min + "çš„" + dis_version + "ç”µå½± ã€Š" +
							name_min_new + "ã€‹ ç°åœ¨å¼€å§‹æ£€ç¥¨è¿›åœº æœ¬å½±åŸç¦æ­¢å¸çƒŸï¼Œè°¢ç»å¤–å¸¦é£Ÿå“ï¼Œè°¢è°¢æ‚¨çš„é…åˆï¼Œç¥æ‚¨è§‚å½±æ„‰å¿«";
						BegDate[i] = time.slice(0, 10);
						BegTime[i] = newBYTime.slice(0, 10) + " " + newBYTime.slice(11, 21);;
						EndDate[i] = time_end.slice(0, 10);
						EndTime[i] = time.slice(0, 10) + " " + time.slice(11, 21);
						/*BYDS_all_json[i] = '{"TaskID":' + '"' + TaskID[i] + '","TaskTopic":"' + TaskTopic[i] +
							'","TaskContent":"' + TaskContent[i] + '","BegDate":"' + BegDate[i] + '","BegTime":"' + BegTime[i] +
							'","EndDate":"' + EndDate[i] + '","EndTime":"' + EndTime[i] + '}';*/
						BYDS_all = BYDS_all + TaskID[i] + "\t" + TaskTopic[i] + "\t" + TaskContent[i] + "\t" + BegDate[i] +
							"\t" + BegTime[i] + "\t" + EndDate[i] + "\t" + EndTime[i] + BYDS_BuBian_all + "\n";
						document.getElementById('byds').innerHTML = BYDS_all;
						//å¤§å±å¹•çš„æ•°ç»„
						let onebyone = {
							display_name: name_min, // å‡è®¾ç”µå½±åæ˜¯Movie 1, Movie 2, ...
							show_time_start: time // å‡è®¾å¼€åœºæ—¶é—´æ˜¯æ¯éš”ä¸¤å°æ—¶ä¸€åœºï¼Œä»10:00å¼€å§‹
						}
						moviesData.push(onebyone);

						all = all + jsonData.data.arr_date_plan[i].hall_name + "  " + jsonData.data.arr_date_plan[i]
							.show_time_start.slice(11, 16) + "  " + jsonData.data.arr_date_plan[i].display_name + "\n"; //å‰å°ç¥¨

						wucha_start = wucha_start + secondsDifference_start + "-1    10110054 010    " + hall_name.slice(0, 1) +
							name_min.slice(0, 3) + dis_version + djs_tishi_dongzuo +
							"                                                                                                                                                                                                                                                                                                       " +
							"\n";
						wucha_end = wucha_end + secondsDifference_end_current + "-1    10110054 010    " + hall_name.slice(0,
								1) + name_min.slice(0, 3) + dis_version + djs_tishi_light_on +
							"                                                                                                                                                                                                                                                                                                      " +
							"\n";
						if (djs_tishi_light_on === 'ç»“æŸ||è¯·æ›´æ–°å‡†ç¡®æ—¶é—´') {
							//å¦‚æœå­˜åœ¨æ²¡æœ‰ç²¾ç¡®å¼€ç¯æ—¶é—´çš„åœºæ¬¡ï¼Œå€’è®¡æ—¶è½¯ä»¶ä¼šåœ¨ç”µå½±å¼€å§‹1å°æ—¶åæ¯åˆ†é’Ÿæç¤ºä¸€æ¬¡
							for (let x = 0; x < 10; x++) {
								var math_secondsDifference_start = Number(secondsDifference_start); //å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—
								math_secondsDifference_start = math_secondsDifference_start + 3600 + 60 *
									x; //ç¬¬ä¸€æ¬¡æç¤ºåœ¨1å°æ—¶åï¼Œä¾æ¬¡é€’åŠ 1åˆ†é’Ÿï¼Œæé†’åæ¬¡
								djs_tishi_dongzuo = '||æœªæ›´æ–°äº®ç¯æ—¶é—´ ç»“æŸæ—¶éœ€æ‰‹åŠ¨å¼€ç¯||è‹¥TMSæœªæ›´æ–°è¯·è¯¢é—®ç»ç†æˆ–æ”¾æ˜ ';
								wucha_start = wucha_start + math_secondsDifference_start + "-1    10110054 010    " + hall_name
									.slice(0, 1) + "å… " +
									name_min.slice(0, 3) + dis_version + djs_tishi_dongzuo +
									"                                                                                                                                                                                                                                                                                                       " +
									"\n";
							}
						}
						//console.log(wucha_1h_tishi);
						wucha_all = wucha_end + wucha_start; //å€’è®¡æ—¶éœ€è¦çš„æœ€ç»ˆæ•°æ®

					}
					//console.log(update_time);
					// å°†å­—ç¬¦ä¸²è½¬ä¸º Date å¯¹è±¡ï¼Œå¹¶æ‰¾åˆ°æœ€å¤§å€¼
					const latestTime = new Date(Math.max(...update_time.map(t => new Date(t.replace(" ", "T")))));
					//console.log(latestTime);

					var todayfirstdate = "å½“å‰æ’æœŸæ—¥æœŸä¸ºï¼š" + jsonData.data.arr_date_plan[0].plan_date + "\n" + "æœ€åæ›´æ–°æ—¶é—´ä¸ºï¼š" +
						formatBeijingTime(latestTime) + "\n";
					//console.log(all); //å‡ºç¥¨ç»“æœç•Œé¢
					NeedCheck = removeDuplicates(NeedCheck); //ç®€åŒ–æé†’çš„åç§°ï¼Œå»æ‰é‡å¤é¡¹
					const NeedCheck_result = arrayToStringWithNewLine(NeedCheck);
					//console.log(NeedCheck_result);
					document.getElementById('checktime').innerHTML = NeedCheck_result;
					//console.log(NeedCheck);//éœ€è¦ç²¾ç¡®æ—¶é—´çš„ç”µå½±å
					// å¤„ç†æ•°æ®å¹¶æ‰“å°ç»“æœ
					const processedData = processMoviesData(moviesData);
					//console.log(processedData);
					const arrayOfArrays = processedData;
					// ä½¿ç”¨ sort() æ–¹æ³•å’Œè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°å¯¹å†…éƒ¨æ•°ç»„æŒ‰é•¿åº¦ä»é•¿åˆ°çŸ­è¿›è¡Œæ’åº
					arrayOfArrays.sort((a, b) => b.length - a.length);
					//console.log(arrayOfArrays);
					const firstItemsJoined = arrayOfArrays.map(innerArray => innerArray[0]).join(':\n') + ":";
					//å»æ‰ï¼ˆæ•°å­—3Dï¼‰
					const targetSubstring = 'ï¼ˆæ•°å­—3Dï¼‰';
					const tihuancheng = '';
					const outputString = replaceSpecifiedString(firstItemsJoined, targetSubstring, tihuancheng);
					//console.log(firstItemsJoined); // å¤§å±å¹•ç”µå½±åç•Œé¢
					//console.log(outputString); // å¤§å±å¹•ç”µå½±åç•Œé¢ï¼Œæ²¡æœ‰æ•°å­—3D
					var alltimes = "";
					// éå†æ•°ç»„å¹¶è¾“å‡ºæ¯ä¸ªå†…éƒ¨æ•°ç»„å‰©ä½™çš„å…ƒç´ ï¼Œæ¯ä¸ªæ•°ç»„è¾“å‡ºåæ¢è¡Œ
					arrayOfArrays.forEach(innerArray => {
						// ç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ åï¼Œå°†å‰©ä½™çš„å…ƒç´ è¿æ¥æˆå­—ç¬¦ä¸²
						const remainingItemsJoined = innerArray.slice(1).join(' ');
						alltimes = alltimes + remainingItemsJoined + "\n"
						// æ¯ä¸ªæ•°ç»„çš„è¾“å‡ºå°†åœ¨æ–°çš„ä¸€è¡Œä¸Š
					});

					//æ‰‹åŠ¨æ›´æ”¹æ’­éŸ³å¤§å¸ˆæå‰æ’­éŸ³æ—¶é—´å’Œæ’­éŸ³é—´éš”
					document.getElementById("finalConfirm").style.display = "inline";
					// Extra çš„å­—æ®µå
					const extraKeys = [
						"Interval",
						"WeekFlag1",
						"WeekFlag2",
						"WeekFlag3",
						"WeekFlag4",
						"WeekFlag5",
						"WeekFlag6",
						"WeekFlag7",
						"DingFlag",
						"VSID",
						"BMID",
						"BCTimes",
						"BCFlag",
						"Timeout",
						"TaskLevel",
						"StopFlag"
					];

					const parsed = BYDS_all
						.trim()
						.split("\n")
						.map(line => {
							const parts = line.split("\t");
							const base = {
								TaskID: parts[0],
								TaskTopic: parts[1],
								TaskContent: parts[2],
								BegDate: parts[3],
								BegTime: parts[4],
								EndDate: parts[5],
								EndTime: parts[6],
							};

							// æ‹†è§£ Extra éƒ¨åˆ†
							const extraValues = parts.slice(7);
							const extraObj = {};
							extraKeys.forEach((key, i) => {
								extraObj[key] = extraValues[i] || null;
							});

							return {
								...base,
								...extraObj
							};
						});

					// æ§åˆ¶å°è¾“å‡ºå¯å±•å¼€çš„ JSON
					//console.log(parsed);
					//console.log(JSON.stringify(parsed, null, 2));
					const tasks = parsed;
					const container = document.getElementById("movieTasks");
					const Tasktable = document.createElement("table");
					Tasktable.innerHTML = `
					  <tr>
					    <th>ç”µå½±</th>
					    <th>ç”µå½±å¼€å§‹å‰__(åˆ†é’Ÿ)æ’­éŸ³</th>
					    <th>æ’­éŸ³é—´éš”(åˆ†é’Ÿ)</th>
					  </tr>
					`;

					// æŒ‰ç”µå½±ååˆ†ç»„
					const movieGroups = {};
					tasks.forEach((task, index) => {
						const end = new Date(task.EndTime);
						const beg = new Date(task.BegTime);
						const gap = Math.floor((end - beg) / 60000);
						if (!movieGroups[task.TaskTopic]) {
							movieGroups[task.TaskTopic] = {
								rows: [],
								gap,
								interval: task.Interval
							};
						}
						movieGroups[task.TaskTopic].rows.push({
							index,
							task
						});
					});

					Object.keys(movieGroups).forEach(movie => {
						const group = movieGroups[movie];
						const tr = document.createElement("tr");
						tr.dataset.movie = movie;
						tr.innerHTML = `
					    <td>${movie}</td>
					    <td><input type="number" class="gapInput" min="1" value="${group.gap}" /></td>
					    <td><input type="number" class="intervalInput" min="1" value="${group.interval}" /></td>
					  `;
						Tasktable.appendChild(tr);
					});

					container.appendChild(Tasktable);

					function formatDateTime(date) {
						const pad = n => n.toString().padStart(2, "0");
						return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
					}

					function formatDate(date) {
						const pad = n => n.toString().padStart(2, "0");
						return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}`;
					}

					document.getElementById("finalConfirm").addEventListener("click", () => {
						const rows = Tasktable.querySelectorAll("tr:not(:first-child)");
						let hasError = false;
						let results = [];

						rows.forEach(row => {
							const movie = row.dataset.movie;
							const gap = parseInt(row.querySelector(".gapInput").value);
							const interval = parseInt(row.querySelector(".intervalInput").value);
							const group = movieGroups[movie];

							if (interval > gap) {
								row.classList.add("error-row");
								hasError = true;
								return;
							} else {
								row.classList.remove("error-row");
							}

							group.rows.forEach(({
								index,
								task: originalTask
							}) => {
								const task = {
									...originalTask
								};
								const end = new Date(task.EndTime);
								const newBeg = new Date(end.getTime() - gap * 60000);
								task.BegTime = formatDateTime(newBeg);
								task.BegDate = formatDate(newBeg);
								task.Interval = interval;
								results.push(task);
							});
						});

						if (hasError) alert("æ’­éŸ³é—´éš”ä¸èƒ½å¤§äºæå‰æ’­éŸ³æ—¶é—´ï¼Œè¯·æ£€æŸ¥çº¢è‰²é«˜äº®è¡Œã€‚");

						// æŒ‰ TaskID å‡åºæ’åº
						results.sort((a, b) => parseInt(a.TaskID) - parseInt(b.TaskID));
						//console.log(JSON.stringify(results, null, 2));
						// å–ç¬¬ä¸€ä¸ªTaskIDä½œä¸ºèµ·å§‹å€¼
						let baseId = parseInt(results[0].TaskID, 10);

						const lines = results.map((item, index) => {
							const newId = baseId + index; // é¡ºå»¶
							const fields = [
								newId,
								item.TaskTopic,
								item.TaskContent,
								item.BegDate,
								item.BegTime,
								item.EndDate,
								item.EndTime,
								item.Interval,
								item.WeekFlag1,
								item.WeekFlag2,
								item.WeekFlag3,
								item.WeekFlag4,
								item.WeekFlag5,
								item.WeekFlag6,
								item.WeekFlag7,
								item.DingFlag,
								item.VSID,
								item.BMID,
								item.BCTimes,
								item.BCFlag,
								item.Timeout,
								item.TaskLevel,
								item.StopFlag
							];
							return fields.join("\t");
						});

						const resultStr = lines.join("\n");
						//console.log(resultStr);
						//ä¿®æ”¹åçš„å€¼å¡«å†™åœ¨å¯¹åº”æ¡†é‡Œ
						document.getElementById('byds').innerHTML = resultStr;
						document.getElementById('copy_byds_sucess').innerHTML = 'ğŸ‘Œå·²ä¿®æ”¹,è¯·é‡æ–°å¤åˆ¶ğŸ‘Œ';
					});
					//console.log(alltimes); //å¤§å±å¹•æ—¶é—´ç•Œé¢
					// å°†ç¥¨ç‰ˆè¾“å‡ºåˆ°è¾“å…¥æ¡†ï¼Œå¤åˆ¶å¹¶æ¸…ç©º
					//document.getElementById('json-input').value = all;
					//document.getElementById('json-input').select();
					//document.execCommand('copy');
					//document.getElementById('json-input').value = "";
					document.getElementById('piao').innerHTML = todayfirstdate + all;
					document.getElementById('djs').innerHTML = wucha_all;
					document.getElementById('movie_name').innerHTML = outputString;
					document.getElementById('movie_time').innerHTML = alltimes;
					//alert("æˆåŠŸ");
					if (sale_status_stop == 0) {
						var sale_status_sale_message = '';
					} else {
						var sale_status_sale_message = ' âŒ›æš‚åœåœºæ¬¡:' + sale_status_stop;
					}
					if (Plan_no == 0) {
						document.getElementById('extractField_sucess').innerHTML = 'ğŸ˜ ğŸ“…' + jsonData.data.arr_date_plan[0]
							.plan_date + ' ğŸ¬æ€»åœºæ¬¡:' + jsonData.data.arr_date_plan.length;

					} else {
						document.getElementById('extractField_sucess').innerHTML = 'ğŸ˜ ğŸ“…' + jsonData.data.arr_date_plan[0]
							.plan_date + ' ğŸ¬æ€»åœºæ¬¡:' + jsonData.data.arr_date_plan.length + ' ğŸ”’æœªé‡Šæ”¾åœºæ¬¡:' + Plan_no;
						alert("æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n" +
							"æœªé‡Šæ”¾åœºæ¬¡:" + Plan_no + "ï¼Œè¯·æé†’ç»ç†é‡Šæ”¾ï¼Œåˆ·æ–°é¡µé¢åé‡æ–°å¤åˆ¶F12çš„å†…å®¹\n"
						)
					}

				} catch (error) {
					// å¦‚æœJSONè§£æå¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯
					console.error('æ— æ•ˆçš„JSONæ•°æ®:', error);
					document.getElementById('json-input').value = "";
					alert("å¤åˆ¶é”™è¯¯ï¼Œè¯·é‡æ–°å¤åˆ¶")
				}
				//setTimeout(sortTableByStartTime, 200);
				//sortTableByStartTime()
			}
		</script>
		<script>
			// è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
			function formatBeijingTime(date) {
				const beijingOffsetMs = 8 * 60 * 60 * 1000;
				const bjDate = new Date(date.getTime() + beijingOffsetMs);
				const yyyy = bjDate.getUTCFullYear();
				const mm = String(bjDate.getUTCMonth() + 1).padStart(2, '0');
				const dd = String(bjDate.getUTCDate()).padStart(2, '0');
				const hh = String(bjDate.getUTCHours()).padStart(2, '0');
				const min = String(bjDate.getUTCMinutes()).padStart(2, '0');
				const ss = String(bjDate.getUTCSeconds()).padStart(2, '0');
				return `${yyyy}-${mm}-${dd} ${hh}:${min}:${ss}`;
			}
			//å¼€å§‹ç”Ÿæˆå¤§å±å¹•æ•°æ®
			function processMoviesData(movies) {
				// å…ˆæŒ‰ç”µå½±åï¼Œå†æŒ‰å¼€åœºæ—¶é—´æ’åº
				movies.sort((a, b) => {
					if (a.display_name < b.display_name) return -1;
					if (a.display_name > b.display_name) return 1;
					return new Date(a.show_time_start) - new Date(b.show_time_start);
				});

				// ä½¿ç”¨reduceå‡½æ•°æŒ‰ç”µå½±ååˆ†ç»„å¹¶æ”¶é›†å¼€åœºæ—¶é—´
				const groupedByMovie = movies.reduce((acc, movie) => {
					if (!acc[movie.display_name]) {
						acc[movie.display_name] = [];
					}
					//acc[movie.display_name].push(movie.show_time_start);
					acc[movie.display_name].push(movie.show_time_start.slice(11, 16));
					return acc;
				}, {});

				// è½¬æ¢ä¸ºæ‰€éœ€çš„è¾“å‡ºæ ¼å¼
				const output = Object.entries(groupedByMovie).map(([movieName, showTimes]) => {
					return [movieName, ...showTimes];
				});

				return output;
			}

			function replaceSpecifiedString(inputString, targetSubstring, tihuancheng) {
				// å¯¹ç›®æ ‡å­å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œä»¥ä¾¿åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨
				const escapedTarget = targetSubstring.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

				// åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨'g'æ ‡å¿—è¿›è¡Œå…¨å±€åŒ¹é…
				const regex = new RegExp(escapedTarget, 'g');

				// æ›¿æ¢æ‰€æœ‰åŒ¹é…åˆ°çš„å­å­—ç¬¦ä¸²ä¸ºç©º
				const result = inputString.replace(regex, tihuancheng);

				return result;
			}

			function copymovie_name() {
				try {
					document.getElementById('movie_name').select();
					document.execCommand('copy');
					document.getElementById('copymovie_name_sucess').innerHTML = 'ğŸ˜';
					//console.log("æˆåŠŸ1")
					//alert("å¤åˆ¶æˆåŠŸ")
				} catch (error) {
					aconsole.error('å¤åˆ¶å¤±è´¥', error);
				}
			}

			function copymovie_time() {
				try {
					document.getElementById('movie_time').select();
					document.execCommand('copy');
					document.getElementById('copymovie_time_sucess').innerHTML = 'ğŸ˜';
					//console.log("æˆåŠŸ2")
					//alert("å¤åˆ¶æˆåŠŸ")
				} catch (error) {
					console.error('å¤åˆ¶å¤±è´¥', error);
				}

			}

			function copypiao() {
				try {
					document.getElementById('piao').select();
					document.execCommand('copy');
					document.getElementById('cpoypiao_sucess').innerHTML = 'ğŸ˜';
					//console.log("æˆåŠŸ2")
					//alert("å¤åˆ¶æˆåŠŸ")
				} catch (error) {
					console.error('å¤åˆ¶å¤±è´¥', error);
				}
			}

			function copydjs() {
				try {
					document.getElementById('djs').select();
					document.execCommand('copy');
					document.getElementById('copy_djs_sucess').innerHTML = 'ğŸ˜';
					//console.log("æˆåŠŸ2")
					//alert("å¤åˆ¶æˆåŠŸ")
				} catch (error) {
					console.error('å¤åˆ¶å¤±è´¥', error);
				}
			}

			function copybyds() {
				try {
					document.getElementById('byds').select();
					document.execCommand('copy');
					document.getElementById('copy_byds_sucess').innerHTML = 'ğŸ˜';
					//console.log("æˆåŠŸ2")
					//alert("å¤åˆ¶æˆåŠŸ")
				} catch (error) {
					console.error('å¤åˆ¶å¤±è´¥', error);
				}
			}
			//å‰å°ï¼šæŒ‰ç…§ç”µå½±åæ’åº
			function QTname() {
				// å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªè¡¨æ ¼å…ƒç´ ï¼Œå…¶idä¸º"myTable"
				const table = document.getElementById('tableContainer').getElementsByTagName("table")[0];

				// è·å–è¡¨æ ¼ä¸­çš„æ‰€æœ‰è¡Œï¼ˆé™¤äº†è¡¨å¤´ï¼‰
				const rows = Array.from(table.rows).slice(1); // æ’é™¤ç¬¬ä¸€è¡Œï¼Œé€šå¸¸æ˜¯è¡¨å¤´

				// æå–æŸä¸€åˆ—ï¼ˆä¾‹å¦‚ï¼Œç¬¬äºŒåˆ—ï¼‰çš„æ•°æ®å¹¶è¿›è¡Œæ’åº
				// è¿™é‡Œæˆ‘ä»¬å‡è®¾æ’åºçš„åˆ—åŒ…å«æ–‡æœ¬æ•°æ®ï¼Œå¹¶ä½¿ç”¨å­—ç¬¦ä¸²çš„localeCompareè¿›è¡Œæ’åº
				const columnData = rows.map(row => row.cells[2].textContent); // è·å–ç¬¬ä¸‰åˆ—çš„æ•°æ®
				const sortedIndices = columnData.map((_, index) => index).sort((a, b) => columnData[a].localeCompare(columnData[
					b])); // è·å–æ’åºåçš„ç´¢å¼•

				// æ ¹æ®æ’åºåçš„ç´¢å¼•é‡æ–°æ’åˆ—è¡Œ
				const sortedRows = sortedIndices.map(index => rows[index]);

				// æ¸…ç©ºè¡¨æ ¼ä½“ï¼Œç„¶åé‡æ–°æ·»åŠ æ’åºåçš„è¡Œ
				const tbody = table.tBodies[0]; // è·å–è¡¨æ ¼ä½“å…ƒç´ 
				while (tbody.firstChild) {
					tbody.removeChild(tbody.firstChild); // æ¸…ç©ºè¡¨æ ¼ä½“
				}
				sortedRows.forEach(row => tbody.appendChild(row)); // æ·»åŠ æ’åºåçš„è¡Œ
			}

			function sortTableByStartTime() {
				extractField();
				xianshi_button_deleteMovie();
				var table, rows, switching, i, x, y, shouldSwitch;
				table = document.getElementById("tableContainer").getElementsByTagName("table")[0];
				switching = true;
				while (switching) {
					switching = false;
					rows = table.getElementsByTagName("tr");
					for (i = 1; i < (rows.length - 1); i++) {
						shouldSwitch = false;
						x = rows[i].getElementsByTagName("td")[0].innerHTML;
						y = rows[i + 1].getElementsByTagName("td")[0].innerHTML;
						if (x.toLowerCase() > y.toLowerCase()) {
							shouldSwitch = true;
							break;
						}
					}
					if (shouldSwitch) {
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
					}
				}
				var tbody = table.querySelector('tbody');

				// éå†tbodyä¸­çš„æ¯ä¸€è¡Œ
				var rows = tbody.querySelectorAll('tr');
				rows.forEach(function(row) {
					// è·å–å½“å‰è¡Œçš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—å…ƒç´ 
					var firstCell = row.querySelector('td:nth-child(1)');
					var secondCell = row.querySelector('td:nth-child(2)');

					// ç¡®ä¿è¿™ä¸¤ä¸ªå•å…ƒæ ¼å­˜åœ¨
					if (firstCell && secondCell) {
						// è·å–ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—çš„å†…å®¹
						var firstContent = firstCell.textContent || firstCell.innerText;
						var secondContent = secondCell.textContent || secondCell.innerText;

						// å¦‚æœå†…å®¹é•¿åº¦å¤§äº11ï¼Œåˆ™åˆ é™¤å‰11ä¸ªå­—ç¬¦
						if (firstContent.length > 11) {
							firstCell.textContent = firstContent.slice(11, 16);
						}
						if (secondContent.length > 11) {
							secondCell.textContent = secondContent.slice(11, 16);
						}
					}
				});
				console.log('å¼€å§‹æ—¶é—´æ’åº');
			}

			function sortTableByEndTime() { //ä¿æ´è¡¨
				extractField();
				yincang_deleteMovie()
				var table, rows, switching, i, x, y, shouldSwitch;
				table = document.getElementById("tableContainer").getElementsByTagName("table")[0];
				switching = true;
				while (switching) {
					switching = false;
					rows = table.getElementsByTagName("tr");
					for (i = 1; i < (rows.length - 1); i++) {
						shouldSwitch = false;
						x = rows[i].getElementsByTagName("td")[1].innerHTML;
						y = rows[i + 1].getElementsByTagName("td")[1].innerHTML;
						if (x.toLowerCase() > y.toLowerCase()) {
							shouldSwitch = true;
							break;
						}
					}
					if (shouldSwitch) {
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
					}
				}
				var tbody = table.querySelector('tbody');

				// éå†tbodyä¸­çš„æ¯ä¸€è¡Œ
				var rows = tbody.querySelectorAll('tr');
				rows.forEach(function(row) {
					// è·å–å½“å‰è¡Œçš„ç¬¬ä¸€åˆ—,ç¬¬äºŒåˆ—,ç¬¬ä¸‰åˆ—å…ƒç´ 
					var firstCell = row.querySelector('td:nth-child(1)');
					var secondCell = row.querySelector('td:nth-child(2)');
					var thirdCell = row.querySelector('td:nth-child(3)');
					// ç¡®ä¿è¿™ä¸¤ä¸ªå•å…ƒæ ¼å­˜åœ¨
					if (firstCell && secondCell && thirdCell) {
						// è·å–ç¬¬ä¸€åˆ—,ç¬¬äºŒåˆ—,ç¬¬ä¸‰åˆ—çš„å†…å®¹
						var firstContent = firstCell.textContent || firstCell.innerText;
						var secondContent = secondCell.textContent || secondCell.innerText;
						var thiredContent = thirdCell.textContent || thirdCell.innerText;
						var stringsToReplace = ['ï¼ˆæ—¥è¯­ï¼‰', 'ï¼ˆè‹±è¯­ï¼‰', 'ï¼ˆå…¶ä»–ï¼‰', 'ï¼ˆå°åº¦è¯­ï¼‰', 'ï¼ˆå°å°¼è¯­ï¼‰', 'ï¼ˆæ³•è¯­ï¼‰', 'ï¼ˆæ„å¤§åˆ©è¯­ï¼‰', 'ï¼ˆéŸ©è¯­ï¼‰',
							'ï¼ˆä¿„è¯­ï¼‰', 'ğŸŒ',
							' 3DğŸ‘“'
						];
						var originalString = thiredContent;
						//console.log(originalString);
						thiredContent = replaceMatchesWithEmptyString(originalString, stringsToReplace);
						//console.log(thiredContent);
						const result_thiredContent = processMovieString(thiredContent);
						//console.log(result_thiredContent);
						if (result_thiredContent == null || result_thiredContent.lightOnTime == undefined ||
							result_thiredContent.posterTime == undefined || result_thiredContent.lightOnTime == '' ||
							result_thiredContent.posterTime == '') {
							console.log("æœªæŸ¥è¯¢åˆ° " + thiredContent + " å…·ä½“ç»“æŸæ—¶é—´")
							thiredContent = "â–ˆ" + thiredContent;
						} else if (result_thiredContent.lightOnTime !== undefined || result_thiredContent.posterTime !==
							undefined) {
							// åˆå§‹æœ¬åœ°æ—¶é—´å­—ç¬¦ä¸²ï¼ˆISO 8601 æ ¼å¼ï¼Œæ— æ—¶åŒºä¿¡æ¯ï¼‰
							const initialTimeString = firstContent;

							// å°†æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸º Date å¯¹è±¡
							const initialDate = new Date(initialTimeString);

							// å¢åŠ ã€å‡å°‘çš„æœ¬åœ°æ—¶é—´å­—ç¬¦ä¸²
							const timeToAddString = result_thiredContent.lightOnTime; //å¢åŠ æ—¶é—´
							const timeToSubtractString = result_thiredContent.posterTime; //å‡å°‘æ—¶é—´
							// è§£æå¹¶å¢åŠ ã€å‡å°‘æ—¶é—´
							const [hoursToAdd_lightOnTime, minutesToAdd_lightOnTime, secondsToAdd_lightOnTime] =
							timeToAddString.split(':').map(Number); //äº®ç¯æ—¶é—´
							const millisecondsToAdd = (hoursToAdd_lightOnTime * 3600000) + (minutesToAdd_lightOnTime *
								60000) + (secondsToAdd_lightOnTime * 1000); //å¢åŠ    æ ¼å¼åŒ–äº®ç¯æ—¶é—´
							const [hoursToSubtract_posterTime, minutesToSubtract_posterTime,
								secondsToSubtract_posterTime
							] = timeToSubtractString.split(':').map(Number); //é¾™æ ‡æ—¶é—´
							const millisecondsToSubtract = (hoursToSubtract_posterTime * 3600000) + (
								minutesToSubtract_posterTime * 60000) + (secondsToSubtract_posterTime *
								1000); //å‡å°‘  æ ¼å¼åŒ–é¾™æ ‡æ—¶é—´
							initialDate.setTime(initialDate.getTime() + millisecondsToAdd -
								millisecondsToSubtract); //æ­£ç¡®äº®ç¯æ—¶é—´=å¼€å§‹æ—¶é—´+äº®ç¯æ—¶é—´(åŒ…æ‹¬å¹¿å‘Š)-é¾™æ ‡æ—¶é—´

							// æ‰‹åŠ¨æ„å»º ISO 8601 æ ¼å¼çš„è¾“å‡ºå­—ç¬¦ä¸²ï¼ˆæ— æ—¶åŒºä¿¡æ¯ï¼‰
							const year = initialDate.getFullYear();
							const month = String(initialDate.getMonth() + 1).padStart(2, '0'); // æœˆä»½ä»0å¼€å§‹ï¼Œéœ€è¦åŠ 1
							const day = String(initialDate.getDate()).padStart(2, '0');
							const hours = String(initialDate.getHours()).padStart(2, '0');
							const minutes = String(initialDate.getMinutes()).padStart(2, '0');
							const seconds = String(initialDate.getSeconds()).padStart(2, '0');
							const resultTimeString = `${year}-${month}-${day}T${hours}:${minutes}:${seconds}`;
							//console.log(thiredContent.slice(0, 9) + " ä¸¨ " + firstContent.slice(11, 16) + " ä¸¨ " + secondContent.slice(11, 16) + " ä¸¨ " + resultTimeString.slice(11, 16))
							secondContent = resultTimeString;
						}
						// å¦‚æœå†…å®¹é•¿åº¦å¤§äº11ï¼Œåˆ™åˆ é™¤å‰11ä¸ªå­—ç¬¦
						if (firstContent.length > 11) {
							firstCell.textContent = firstContent.slice(11, 16);
						}
						if (secondContent.length > 11) {
							secondCell.textContent = secondContent.slice(11, 16);
						}
						//é˜²æ­¢ç”µå½±åè¿‡é•¿ï¼Œåªæ˜¾ç¤ºå‰ä¹ä¸ªå­—
						thirdCell.textContent = thiredContent.slice(0, 9);
					}
				});
				splitTable();
				xianshi();
				console.log('ç»“æŸæ—¶é—´æ’åº');
			}

			function sortTableByMovie() {
				yincang_deleteMovie()
				extractField();
				var table, rows, switching, i, x, y, shouldSwitch;
				table = document.getElementById("tableContainer").getElementsByTagName("table")[0];
				switching = true;
				while (switching) {
					switching = false;
					rows = table.getElementsByTagName("tr");
					for (i = 1; i < (rows.length - 1); i++) {
						shouldSwitch = false;
						x = rows[i].getElementsByTagName("td")[2].innerHTML;
						y = rows[i + 1].getElementsByTagName("td")[2].innerHTML;
						if (x.toLowerCase() > y.toLowerCase()) {
							shouldSwitch = true;
							break;
						}
					}
					if (shouldSwitch) {
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
					}
				}
				var tbody = table.querySelector('tbody');

				// éå†tbodyä¸­çš„æ¯ä¸€è¡Œ
				var rows = tbody.querySelectorAll('tr');
				rows.forEach(function(row) {
					// è·å–å½“å‰è¡Œçš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—å…ƒç´ 
					var firstCell = row.querySelector('td:nth-child(1)');
					var secondCell = row.querySelector('td:nth-child(2)');

					// ç¡®ä¿è¿™ä¸¤ä¸ªå•å…ƒæ ¼å­˜åœ¨
					if (firstCell && secondCell) {
						// è·å–ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—çš„å†…å®¹
						var firstContent = firstCell.textContent || firstCell.innerText;
						var secondContent = secondCell.textContent || secondCell.innerText;

						// å¦‚æœå†…å®¹é•¿åº¦å¤§äº11ï¼Œåˆ™åˆ é™¤å‰11ä¸ªå­—ç¬¦
						if (firstContent.length > 11) {
							firstCell.textContent = firstContent.slice(11, 16);
						}
						if (secondContent.length > 11) {
							secondCell.textContent = secondContent.slice(11, 16);
						}
					}
				});
				console.log('ç”µå½±åæ’åº');
				deleteCheckbox();
			}

			function sortTableByCellName() {
				yincang_deleteMovie()
				extractField();
				var table, rows, switching, i, x, y, shouldSwitch;
				table = document.getElementById("tableContainer").getElementsByTagName("table")[0];
				switching = true;
				while (switching) {
					switching = false;
					rows = table.getElementsByTagName("tr");
					for (i = 1; i < (rows.length - 1); i++) {
						shouldSwitch = false;
						x = rows[i].getElementsByTagName("td")[3].innerHTML;
						y = rows[i + 1].getElementsByTagName("td")[3].innerHTML;
						if (x.toLowerCase() > y.toLowerCase()) {
							shouldSwitch = true;
							break;
						}
					}
					if (shouldSwitch) {
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
					}
				}
				var tbody = table.querySelector('tbody');

				// éå†tbodyä¸­çš„æ¯ä¸€è¡Œ
				var rows = tbody.querySelectorAll('tr');
				rows.forEach(function(row) {
					// è·å–å½“å‰è¡Œçš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—å…ƒç´ 
					var firstCell = row.querySelector('td:nth-child(1)');
					var secondCell = row.querySelector('td:nth-child(2)');

					// ç¡®ä¿è¿™ä¸¤ä¸ªå•å…ƒæ ¼å­˜åœ¨
					if (firstCell && secondCell) {
						// è·å–ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—çš„å†…å®¹
						var firstContent = firstCell.textContent || firstCell.innerText;
						var secondContent = secondCell.textContent || secondCell.innerText;

						// å¦‚æœå†…å®¹é•¿åº¦å¤§äº11ï¼Œåˆ™åˆ é™¤å‰11ä¸ªå­—ç¬¦
						if (firstContent.length > 11) {
							firstCell.textContent = firstContent.slice(11, 16);
						}
						if (secondContent.length > 11) {
							secondCell.textContent = secondContent.slice(11, 16);
						}
					}
				});
				console.log('å…åæ’åº');
				deleteCheckbox();
			}

			function jianhua_time() {
				// è·å–è¡¨æ ¼å…ƒç´ 
				var table = document.querySelector('#tableContainer table');
				// è·å–è¡¨æ ¼çš„tbodyå…ƒç´ 
				var tbody = table.querySelector('tbody');

				// éå†tbodyä¸­çš„æ¯ä¸€è¡Œ
				var rows = tbody.querySelectorAll('tr');
				rows.forEach(function(row) {
					// è·å–å½“å‰è¡Œçš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—å…ƒç´ 
					var firstCell = row.querySelector('td:nth-child(1)');
					var secondCell = row.querySelector('td:nth-child(2)');

					// ç¡®ä¿è¿™ä¸¤ä¸ªå•å…ƒæ ¼å­˜åœ¨
					if (firstCell && secondCell) {
						// è·å–ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—çš„å†…å®¹
						var firstContent = firstCell.textContent || firstCell.innerText;
						var secondContent = secondCell.textContent || secondCell.innerText;

						// å¦‚æœå†…å®¹é•¿åº¦å¤§äº11ï¼Œåˆ™åˆ é™¤å‰11ä¸ªå­—ç¬¦
						if (firstContent.length > 11) {
							firstCell.textContent = firstContent.slice(11, 16);
						}
						if (secondContent.length > 11) {
							secondCell.textContent = secondContent.slice(11, 16);
						}
					}
				});
			}
			// è®¡ç®—æ—¶é—´å·®çš„å‡½æ•°
			function calculateTimeDifference(lightOnTime, posterTime) { //ç»“æŸæ—¶é—´ï¼Œé¾™æ ‡æ—¶é—´
				const lightOnDate = new Date(`1970-01-01T${lightOnTime}Z`);
				const posterDate = new Date(`1970-01-01T${posterTime}Z`);
				return Math.round((lightOnDate - posterDate) / 1000); // è¿”å›ç§’æ•°
			}

			// å¤„ç†å­—ç¬¦ä¸²ä¸ç”µå½±ååŒ¹é…ï¼Œå¹¶è¿”å›æ˜µç§°å’Œæ—¶é—´å·®çš„å‡½æ•°
			function processMovieString(inputString) {
				for (const movie of movies) {
					//console.log(movies);
					if (movie.name === inputString) {
						const timeDifference = calculateTimeDifference(movie.lightOnTime, movie.posterTime);
						return {
							name: movie.name,
							nickname: movie.nickname,
							timeDifference,
							lightOnTime: movie.lightOnTime,
							posterTime: movie.posterTime
						};
					}
					//console.log(movie.name + "----" + movie.lightOnTime)
				}
				// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç”µå½±ï¼Œå¯ä»¥è¿”å›nullæˆ–å…¶ä»–å€¼
				return null;
			}

			function readFile() {
				const fileInput = document.getElementById('excel-file');
				const file = fileInput.files[0];

				if (!file) {
					console.log("æœªé€‰æ‹©æ–‡ä»¶");
					return;
				}

				const reader = new FileReader();
				reader.onload = function(e) {
					const data = new Uint8Array(e.target.result);
					const workbook = XLSX.read(data, {
						type: 'array'
					});

					// å‡è®¾ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨åŒ…å«æ‰€éœ€æ•°æ®
					const worksheetName = workbook.SheetNames[0];
					const worksheet = workbook.Sheets[worksheetName];

					// å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSONå¯¹è±¡æ•°ç»„
					var jsonData_excel = XLSX.utils.sheet_to_json(worksheet, {
						header: 1
					}); // header: 1 è¡¨ç¤ºç¬¬ä¸€è¡Œæ˜¯æ ‡é¢˜è¡Œ

					// æ‰“å°è¯»å–åˆ°çš„å†…å®¹
					//
					jsonData_excel = jsonData_excel.map(function(subArray) {
						// è½¬æ¢å­æ•°ç»„ä¸ºå¯¹è±¡
						return {
							name: subArray[0], // å‡è®¾ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯nameï¼Œç”µå½±å
							nickname: subArray[1], // å‡è®¾ç¬¬äºŒä¸ªå…ƒç´ æ˜¯nicknameï¼Œç”µå½±æ˜µç§°
							lightOnTime: subArray[2], // å‡è®¾ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯lightOnTimeï¼Œç»“æŸæ—¶é—´
							posterTime: subArray[3] // å‡è®¾ç¬¬å››ä¸ªå…ƒç´ æ˜¯posterTimeï¼Œé¾™æ ‡æ—¶é—´
						};
					});
					//console.log(jsonData_excel);
					//console.log(movies);
					movies = [...jsonData_excel, ...movies];
					// å»é‡ï¼šä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ name
					const seen = new Set();
					movies = movies.filter(item => {
						if (seen.has(item.name)) return false;
						seen.add(item.name);
						return true;
					});
					//console.log(movies);

				};
				reader.readAsArrayBuffer(file);
				document.getElementById('readFile_sucess').innerHTML = "ğŸ˜ğŸ‘‰"
			}

			// âœ… æ£€æµ‹æ˜¯å¦ä¸ºæ¡Œé¢ç‰ˆ Google Chromeï¼Œå¹¶è¿›è¡Œæ‹¦æˆªæç¤º
			function checkIfDesktopChrome() {
				var ua = navigator.userAgent;
				var vendor = navigator.vendor;
				var isDesktopChrome = /Chrome/.test(ua) &&
					/Google Inc/.test(vendor) &&
					!/Edg/.test(ua) // æ’é™¤ Edge
					&&
					!/OPR/.test(ua) // æ’é™¤ Opera
					&&
					!/Mobile/.test(ua); // æ’é™¤ç§»åŠ¨ç«¯ Chrome

				if (isDesktopChrome) {
					alert("è¯·ä½¿ç”¨Edgeæµè§ˆå™¨æ‰“å°\nè¯·ä½¿ç”¨Edgeæµè§ˆå™¨æ‰“å°\nè¯·ä½¿ç”¨Edgeæµè§ˆå™¨æ‰“å°\nè¯·ä½¿ç”¨Edgeæµè§ˆå™¨æ‰“å°\nè¯·ä½¿ç”¨Edgeæµè§ˆå™¨æ‰“å°");
					return true; // è¡¨ç¤ºå·²æ‹¦æˆª
				}
				return false; // è¡¨ç¤ºå¯ç»§ç»­æ‰§è¡Œ
			}

			function hideElementIfEdge(elementId) {
				var ua = navigator.userAgent;
				// å…¼å®¹æ–°æ—§ç‰ˆæœ¬ Edgeï¼ˆæ—§ç‰ˆå¸¦ "Edge"ï¼Œæ–°ç‰ˆåŸºäº Chromium å¸¦ "Edg"ï¼‰
				var isEdge = /Edg/.test(ua) || /Edge/.test(ua);

				if (isEdge) {
					var el = document.getElementById(elementId);
					if (el) {
						el.style.display = "none";
					}
				}
			}

			// âœ… æ‰“å°æ–¹æ³•ç¤ºä¾‹
			function printDiv() {
				// è°ƒç”¨æ£€æµ‹å‡½æ•°ï¼Œå¦‚æœè¿”å› trueï¼Œåˆ™ä¸­æ–­æ‰§è¡Œ
				if (checkIfDesktopChrome()) return;

				var printArea = document.getElementById('tableContainer');
				var printFrame = document.getElementById('printFrame');
				var printWindow = printFrame.contentWindow || printFrame.contentDocument.document;

				// è®¾ç½®iframeçš„å®½é«˜ä»¥åŒ¹é…æ‰“å°divçš„å®½é«˜
				printFrame.style.width = printArea.offsetWidth + 'px';
				printFrame.style.height = printArea.offsetHeight + 'px';

				// å°†divçš„å†…å®¹å†™å…¥iframeçš„documentä¸­
				printWindow.document.open();
				printWindow.document.write(
					'<html><head><title>æ‰“å°å†…å®¹</title><style>' +
					/* åœ¨è¿™é‡Œå¤åˆ¶æ‰“å°æ ·å¼ */
					'</style></head><body>' +
					printArea.innerHTML +
					'</body></html>'
				);
				deleteCheckbox();
				printWindow.document.close();

				// æ‰“å°iframeçš„å†…å®¹
				printWindow.focus(); // ç¡®ä¿iframeè·å¾—ç„¦ç‚¹
				printWindow.print();
			}


			function printDivZao() {
				if (checkIfDesktopChrome()) return;
				var printArea = document.getElementById('splitTables_1');
				var printFrame = document.getElementById('printFrame');
				var printWindow = printFrame.contentWindow || printFrame.contentDocument.document;

				// è®¾ç½®iframeçš„å®½é«˜ä»¥åŒ¹é…æ‰“å°divçš„å®½é«˜
				printFrame.style.width = printArea.offsetWidth + 'px';
				printFrame.style.height = printArea.offsetHeight + 'px';

				// å°†divçš„å†…å®¹å†™å…¥iframeçš„documentä¸­
				printWindow.document.open();
				printWindow.document.write(
					'<html><head><title>æ‰“å°å†…å®¹</title><style>' +
					/* åœ¨è¿™é‡Œå¤åˆ¶æ‰“å°æ ·å¼ */
					'</style></head><body>' +
					printArea.innerHTML +
					'</body></html>'
				);
				printWindow.document.close();
				// æ‰“å°iframeçš„å†…å®¹
				printWindow.focus(); // ç¡®ä¿iframeè·å¾—ç„¦ç‚¹
				printWindow.print();
			}

			function printDivWan() {
				if (checkIfDesktopChrome()) return;
				var printArea = document.getElementById('splitTables_2');
				var printFrame = document.getElementById('printFrame');
				var printWindow = printFrame.contentWindow || printFrame.contentDocument.document;

				// è®¾ç½®iframeçš„å®½é«˜ä»¥åŒ¹é…æ‰“å°divçš„å®½é«˜
				printFrame.style.width = printArea.offsetWidth + 'px';
				printFrame.style.height = printArea.offsetHeight + 'px';

				// å°†divçš„å†…å®¹å†™å…¥iframeçš„documentä¸­
				printWindow.document.open();
				printWindow.document.write(
					'<html><head><title>æ‰“å°å†…å®¹</title><style>' +
					/* åœ¨è¿™é‡Œå¤åˆ¶æ‰“å°æ ·å¼ */
					'</style></head><body>' +
					printArea.innerHTML +
					'</body></html>'
				);
				printWindow.document.close();
				// æ‰“å°iframeçš„å†…å®¹
				printWindow.focus(); // ç¡®ä¿iframeè·å¾—ç„¦ç‚¹
				printWindow.print();
			}
			//åŸå§‹å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šéœ€è¦æ›¿æ¢ä¸ºç©ºçš„å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„  åŸå§‹å­—ç¬¦ä¸²ï¼šoriginalString    éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä¸²ç»„ï¼šstringsToReplace
			function replaceMatchesWithEmptyString(originalString, stringsToReplace) {
				// éå†å­—ç¬¦ä¸²æ•°ç»„
				stringsToReplace.forEach(function(str) {
					// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œå…¨å±€æœç´¢æ ‡å¿—æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹
					var regex = new RegExp(str, 'g');
					originalString = originalString.replace(regex, '');
				});

				// è¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²
				return originalString;
			}
			//å»æ‰æ•°ç»„ä¸­ç›¸åŒçš„æ•°æ®
			function removeDuplicates(array) {
				return Array.from(new Set(array));
			}

			function arrayToStringWithNewLine(array) {
				// ä½¿ç”¨mapæ–¹æ³•å°†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²  
				const stringArray = array.map(item => String(item));
				// ä½¿ç”¨joinæ–¹æ³•å°†æ‰€æœ‰å­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªé•¿å­—ç¬¦ä¸²ï¼Œå…ƒç´ ä¹‹é—´ç”¨æ¢è¡Œç¬¦è¿æ¥
				const result = stringArray.join('\n');
				return result;
			}
			//æ‹†åˆ†è¡¨æ ¼
			function splitTable() {
				// è·å–åŸå§‹è¡¨æ ¼
				var originalTable = document.getElementById('tableContainer_div');
				deleteCheckbox();
				var rows = Array.from(originalTable.tBodies[0].rows);
				// åˆ›å»ºæ–°è¡¨æ ¼çš„å®¹å™¨
				var splitTablesContainer_1 = document.getElementById('splitTables_1');
				var splitTablesContainer_2 = document.getElementById('splitTables_2');
				splitTablesContainer_1.innerHTML = ''; // æ¸…ç©ºå®¹å™¨å†…å®¹
				splitTablesContainer_2.innerHTML = ''; // æ¸…ç©ºå®¹å™¨å†…å®¹
				// åˆ›å»ºä¸¤ä¸ªæ–°è¡¨æ ¼
				var table1 = document.createElement('table');
				var table2 = document.createElement('table');
				table1.style.borderCollapse = 'collapse';
				table1.style.fontSize = 'smaller';
				table1.id = 'tableContainer_div1';
				table2.style.borderCollapse = 'collapse';
				table2.style.fontSize = 'smaller';
				table2.id = 'tableContainer_div2';
				// æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¡¨å¤´ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ
				var thead;
				if (originalTable.tHead) {
					thead = originalTable.tHead.cloneNode(true); // å…‹éš†è¡¨å¤´
				} else {
					thead = document.createElement('thead');
					var firstRow = originalTable.tBodies[0].rows[0].cloneNode(true);
					thead.appendChild(firstRow);
				}

				// ä¸ºä¸¤ä¸ªæ–°è¡¨æ ¼æ·»åŠ è¡¨å¤´
				table1.appendChild(thead.cloneNode(true));
				table2.appendChild(thead.cloneNode(true));

				// æ‹†åˆ†è¡¨æ ¼è¡Œå¹¶æ·»åŠ åˆ°æ–°è¡¨æ ¼ä¸­
				rows.forEach(row => {
					var endTime = row.cells[1].textContent;
					var isBetween5And1630 = endTime >= '05:00' && endTime < '16:30';
					var newRow = row.cloneNode(true); // å…‹éš†è¡Œ
					if (isBetween5And1630) {
						// ç¡®ä¿table1æœ‰tbody
						if (!table1.tBodies.length) {
							var tbody = document.createElement('tbody');
							table1.appendChild(tbody);
						}
						table1.tBodies[0].appendChild(newRow); // æ·»åŠ åˆ°ç¬¬äºŒä¸ªè¡¨æ ¼
					} else {
						// ç¡®ä¿table2æœ‰tbody
						if (!table2.tBodies.length) {
							var tbody = document.createElement('tbody');
							table2.appendChild(tbody);
						}
						table2.tBodies[0].appendChild(newRow); // æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªè¡¨æ ¼
					}
				});

				// å°†æ–°è¡¨æ ¼æ·»åŠ åˆ°å®¹å™¨ä¸­
				splitTablesContainer_1.appendChild(table1);
				//splitTablesContainer.appendChild(document.createElement('br')); // æ·»åŠ æ¢è¡Œ
				splitTablesContainer_2.appendChild(table2);
			}

			function yincang() {
				var zaoban = document.getElementById('zao');
				var wanban = document.getElementById('wan');
				zaoban.style.display = 'none';
				wanban.style.display = 'none';
			}

			function xianshi() {
				var zaoban = document.getElementById('zao');
				var wanban = document.getElementById('wan');
				zaoban.style.display = 'inline-table';
				wanban.style.display = 'inline-table';
			}

			function xianshi_button_deleteMovie() {
				var xianshi_button_deleteMovie = document.getElementById('button_deleteMovie');
				xianshi_button_deleteMovie.style.display = '';
			}

			// åˆ é™¤ä¸éœ€è¦çš„è™šæ‹Ÿåœºæ¬¡ï¼Œå¤„ç†å¤šé€‰æ¡†é€‰ä¸­çŠ¶æ€çš„å‡½æ•°
			function deleteFalseMovie() {

				// åˆå§‹åŒ–å­˜å‚¨é€‰ä¸­å€¼çš„æ•°ç»„
				//const selectedValues = [];

				// è·å–è¡¨æ ¼ä¸­çš„æ‰€æœ‰å¤šé€‰æ¡†  
				const checkboxes = document.querySelectorAll('#tableContainer_div tbody input[type="checkbox"]');
				//console.log(checkboxes);
				// æ¸…ç©ºæ•°ç»„ï¼ˆå¦‚æœéœ€è¦ä¿ç•™ä¹‹å‰çš„çŠ¶æ€ï¼Œåˆ™ç§»é™¤è¿™è¡Œä»£ç ï¼‰  
				//indicesToDelete.length = 0;

				// éå†æ‰€æœ‰å¤šé€‰æ¡†ï¼Œæ£€æŸ¥å…¶é€‰ä¸­çŠ¶æ€  
				checkboxes.forEach(checkbox => {
					if (checkbox.checked) {
						indicesToDelete.push(checkbox.value);
					}
				});
				sortTableByStartTime()
			}

			//åˆ é™¤æ‰“å°æ—¶ä¼šå‡ºç°çš„å¤šé€‰æ¡†
			function deleteCheckbox() {
				// è·å–è¡¨æ ¼å…ƒç´   
				const table = document.getElementById('tableContainer_div');
				const tbody = table.tBodies[0]; // è·å–ç¬¬ä¸€ä¸ªtbodyå…ƒç´   
				const thead = table.tHead; // è·å–è¡¨å¤´  

				// åˆ é™¤è¡¨å¤´ä¸­çš„æœ€åä¸€åˆ—  
				const headerRow = thead.rows[0];
				headerRow.deleteCell(-1); // -1è¡¨ç¤ºåˆ é™¤æœ€åä¸€åˆ—  

				// åˆ é™¤æ¯ä¸€è¡Œæ•°æ®ä¸­çš„æœ€åä¸€åˆ—  
				for (let i = 0; i < tbody.rows.length; i++) {
					tbody.rows[i].deleteCell(-1);
				}
			}

			function start() {
				document.getElementById('json-input').value = document.getElementById('start').value;
				sortTableByStartTime();

			}

			function yincang_deleteMovie() {
				var button_deleteMovie = document.getElementById('button_deleteMovie');
				button_deleteMovie.style.display = 'none';
			}

			// å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è¯»å– JSON æ–‡ä»¶
			window.onload = async function fetchMovies() {
				try {
					const response = await fetch('time.json'); // è¯»å–åŒè·¯å¾„ä¸‹çš„ time.json æ–‡ä»¶
					if (!response.ok) {
						throw new Error('Network response was not ok');
					}
					const data = await response.json(); // å°†å“åº”è§£æä¸º JSON
					// å°† JSON æ•°æ®èµ‹ç»™ movies_timejson å˜é‡ï¼Œå¹¶è°ƒç”¨ function2
					const movies_timejson = data;
					getMovies_timejson(movies_timejson);
					const tableBody = document.getElementById("movie-table-body");

					// å€’åºå¹¶é™åˆ¶å±•ç¤º20ä¸ª
					const limitedMovies = movies.reverse().slice(0, 20);

					limitedMovies.forEach(movie => {
						const row = document.createElement("tr");

						const nameCell = document.createElement("td");
						nameCell.textContent = movie.name;
						row.appendChild(nameCell);

						// æ˜¾ç¤ºnicknameåˆ—ï¼Œå¦‚æœæ²¡æœ‰nicknameåˆ™æ˜¾ç¤ºç©ºå­—ç¬¦ä¸²
						const nicknameCell = document.createElement("td");
						nicknameCell.textContent = movie.nickname || '';
						row.appendChild(nicknameCell);

						const lightOnTimeCell = document.createElement("td");
						lightOnTimeCell.textContent = movie.lightOnTime;
						row.appendChild(lightOnTimeCell);

						const posterTimeCell = document.createElement("td");
						posterTimeCell.textContent = movie.posterTime;
						row.appendChild(posterTimeCell);

						tableBody.appendChild(row);
					});
				} catch (error) {
					console.error('There was a problem with the fetch operation:', error);
				}
			}
		</script>
	</head>
	<body>
		<h1 style="display:contents">æ’ç‰‡ä¿¡æ¯æå–</h1><span id="X" style="opacity: 0;">.</span>
		<div id="NO1">
			<div>
				<textarea id="start" cols="60" rows="10" style="display: none;"></textarea>
				<button id="copyButton">ç²˜è´´</button>
				<button onclick="extractField()" id="parseBtn">è§£æ</button>
				<div style="display: inline" id="extractField_sucess"></div>
				<br>
				<textarea id="json-input" rows="3" cols="60" placeholder="æ…§å½±äº‘æ’æœŸç•Œé¢<F12>,å¤åˆ¶ä¹‹åç›´æ¥å³é”®ç²˜è´´æˆ–ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®"></textarea>
				<br><br>
				<div style="display: none">
					<button onclick="copypiao()">ã€å¤åˆ¶ã€‘ç¥¨</button>
					<div style="display: inline" id="cpoypiao_sucess"></div>
					<br>
					<textarea id="piao" rows="8" cols="60"></textarea>
				</div>
				<div style="display: inline-table;width: min-content;">
					<div id="jiucuo" style="display: contents;">
						<input type="file" id="excel-file" accept=".xlsx, .xls" style="width: 40%;">
						<button onclick="readFile()">ç¡®å®š</button>
						<div style="display: inline" id="readFile_sucess"></div>
						<button onclick="extractField()">è§£æ</button>
					</div>
					<button onclick="copydjs()" style="float: right;">ã€å¤åˆ¶ã€‘å€’è®¡æ—¶</button>
					<div style="display: inline;float: right;" id="copy_djs_sucess"></div>
					<br>
					<textarea id="djs" rows="8" cols="60"></textarea>
				</div>
				<div style="display: inline-table;width: min-content;">
					<span style="display: inline-table; height: 23px; color: red;">ğŸ› ğŸ› éœ€è¦ç²¾ç¡®æ—¶é—´çš„ç”µå½±ğŸ› ğŸ› </span>
					<textarea id="checktime" rows="8" cols="40" style="color: red;"></textarea>
				</div>

				<br><br>
				<div style="display: inline-table">
					<button onclick="copymovie_name()">ã€å¤åˆ¶ã€‘å¤§å±å¹•:ç”µå½±å</button>
					<div style="display: inline" id="copymovie_name_sucess"></div>
					<br>
					<textarea id="movie_name" rows="8" cols="60"></textarea>
				</div>
				<div style="display: inline-table">
					<button onclick="copymovie_time()">ã€å¤åˆ¶ã€‘å¤§å±å¹•:æ—¶é—´</button>
					<div style="display: inline" id="copymovie_time_sucess"></div>
					<br>
					<textarea id="movie_time" rows="8" cols="60"></textarea>
				</div>
				<br><br>
				<div style="width: 882px; text-align:right">
					<div id="movieTasks"></div>
					<button id="finalConfirm" style="display: none;">ç¡®è®¤ä¿®æ”¹</button>
				</div>
				<div style="display: inline-table;width: min-content;">
					<button style="float: right;" onclick="copybyds()">ã€å¤åˆ¶ã€‘æ’­éŸ³å¤§å¸ˆ</button>
					<div style="display: inline;float: right;" id="copy_byds_sucess"></div>
					<br>
					<textarea id="byds" rows="8" cols="60"></textarea>
				</div>
				<br><br><br>
				<div style="width: fit-content;" id="alltable">
					<div>
						<button onclick="sortTableByStartTime()">åˆ·æ–°</button>
						<button onclick="sortTableByMovie()">å‰å°</button>
						<button onclick="sortTableByEndTime()">ä¿æ´</button>
						<button onclick="sortTableByCellName()">å½±å…</button>
						<button onclick="start()">é‡ç½®</button>
					</div>
					<br>

					<div style="display: inline-table;text-align: center;">
						<button onclick="printDiv()">æ‰“å°å½“å‰è¡¨æ ¼(å…¨å¤©)</button>
						<button onclick="deleteFalseMovie()" style="float:right;"
							id="button_deleteMovie">åˆ é™¤é€‰ä¸­åœºæ¬¡</button>
						<div id="tableContainer"></div>
					</div>
					<div style="display: inline-table;padding-left: 50px;"></div>
					<div style="display: inline-table;text-align: center;" id="zao">
						<button onclick="printDivZao()">æ‰“å°æ—©ç­</button>
						<div id="splitTables_1"></div>
					</div>
					<div style="display: inline-table;padding-left: 50px;"></div>
					<div style="display: inline-table;text-align: center;" id="wan">
						<button onclick="printDivWan()">æ‰“å°æ™šç­</button>
						<div id="splitTables_2"></div>
					</div>
				</div>
				<iframe id="printFrame" src="about:blank"></iframe>
				<script>
					// å½“é¡µé¢åŠ è½½å®Œæˆæ—¶ï¼Œè‡ªåŠ¨èšç„¦åˆ°æ–‡æœ¬åŒºåŸŸ
					document.getElementById('json-input').focus();
					document.getElementById('copyButton').addEventListener('click', function() {
							// å°è¯•ä»å‰ªè´´æ¿è·å–æ–‡æœ¬
							navigator.clipboard.readText()
								.then(text => {
									// å¦‚æœæˆåŠŸè·å–åˆ°æ–‡æœ¬ï¼Œå°†å…¶å¤åˆ¶åˆ°è¾“å…¥æ¡†
									document.getElementById('json-input').value = text;
									//extractField();
								})
								.catch(err => {
									// å¦‚æœè·å–å‰ªè´´æ¿å†…å®¹å¤±è´¥ï¼Œæ‰“å°é”™è¯¯æ¶ˆæ¯
									console.error('Error reading clipboard:', err);
									alert('æ— æ³•ä»å‰ªè´´æ¿å¤åˆ¶å†…å®¹ã€‚');
								});

						}

					);
				</script>
			</div>
			<div id="biao">
				<table border="1">
					<thead>
						<tr>
							<th>ç”µå½±å</th>
							<th>ç”µå½±æ˜µç§°</th> <!-- æ·»åŠ äº†ç”µå½±æ˜µç§°åˆ— -->
							<th>ç»“æŸæ—¶é—´</th>
							<th>é¾™æ ‡æ—¶é—´</th>
						</tr>
					</thead>
					<tbody id="movie-table-body">
						<!-- åŠ¨æ€å†…å®¹ä¼šåœ¨è¿™é‡Œæ’å…¥ -->
					</tbody>
				</table>
			</div>

			<script>
				//å½“æ²¡æœ‰éœ€è¦å¢åŠ ä¿¡æ¯çš„å½±ç‰‡ï¼Œéšè—è¯»å–æ–‡ä»¶æŒ‰é’®
				document.addEventListener("DOMContentLoaded", function() {
					let textarea = document.getElementById("checktime");
					let jiucuoDiv = document.getElementById("jiucuo");

					function toggleDisplay() {
						if (textarea.value.trim() === "") {
							jiucuoDiv.style.display = "none";
						} else {
							jiucuoDiv.style.display = "contents";
						}
					}

					// åˆå§‹æ£€æŸ¥
					toggleDisplay();

					// ä½¿ç”¨ MutationObserver ç›‘å¬ value å˜åŒ–
					let observer = new MutationObserver(toggleDisplay);
					observer.observe(textarea, {
						attributes: true,
						attributeFilter: ["value"]
					});

					// å…¼å®¹æŸäº›æƒ…å†µä¸‹èµ‹å€¼ä¸ä¼šè§¦å‘ MutationObserver
					setInterval(toggleDisplay, 500);
				});
			</script>
		</div>

		<div>
			<div>
				<div>
					<div>
						<div>
							<div>
								<div>
									<div>
										<div>
											<div>
												<div>
													<div>
														<div>
															<div>
																<div id="NO2" style="display: none;">
																	<select id="resultSelect"></select><br><br>

																	<!-- æ–°å¢è¾“å…¥æ¡† -->
																	<input type="text" id="rowInput"
																		style="width:80px;"><label>æ’</label>
																	<input type="text" id="seatInput"
																		style="width:80px;"><label>å·</label>

																	<!-- âœ… æ–°å¢ä¸‹æ‹‰æ¡† -->
																	<select id="sourceSelect">
																		<option value="">æ— </option>
																		<option value="å­¦ç”Ÿ">å­¦ç”Ÿ</option>
																		<option value="æŠ–éŸ³">æŠ–éŸ³</option>
																		<option value="å·¥ä¼š">å·¥ä¼š</option>
																	</select>

																	<!-- æ‰“å°å†…å®¹åŒºåŸŸ -->
																	<div id="NO3"
																		style="position: relative;height:84mm; width: 79mm;">
																		<span id="hall"
																			style="position: absolute; left: 10mm; top: 2mm; font-size: 12px;"></span><!-- å·¦|å… -->
																		<span id="name"
																			style="position: absolute; left: 10mm; top: 9mm; font-size: 12px;"></span><!-- å·¦|ç”µå½±å -->
																		<span id="date"
																			style="position: absolute; left: 37mm; top: 1mm; font-size: 12px;"></span><!-- å·¦|æ—¥æœŸ -->
																		<span id="time"
																			style="position: absolute; left: 42mm; top: 4mm; font-size: 12px;"></span><!-- å·¦|æ—¶é—´ -->
																		<span id="rowSpan"
																			style="position: absolute; left: 10mm; top: 15mm; font-size: 12px;"></span><!-- å·¦|æ’ -->
																		<span id="seatSpan"
																			style="position: absolute; left: 20mm; top: 15mm; font-size: 12px;"></span><!-- å·¦|åº§ -->
																		<span id="hall2"
																			style="position: absolute; left: 60mm; top: 2mm; font-size: 12px;"></span><!-- å³|å… -->
																		<span id="date2"
																			style="position: absolute; left: 60mm; top: 15mm; font-size: 12px;"></span><!-- å³|æ—¥æœŸ -->
																		<span id="time2"
																			style="position: absolute; left: 64mm; top: 19mm; font-size: 12px;"></span><!-- å³|æ—¶é—´ -->
																		<span id="rowSpan2"
																			style="position: absolute; left: 66mm; top: 32mm; font-size: 12px;"></span><!-- å³|æ’ -->
																		<span id="seatSpan2"
																			style="position: absolute; left: 66mm; top: 36mm; font-size: 12px;"></span><!-- å³|åº§ -->
																		<span id="nowTime"
																			style="position: absolute; left: 10mm; top: 27mm; font-size: 12px;"></span><!-- å½“å‰æ—¶é—´ -->
																		<span id="sourceSpan"
																			style="position: absolute; left: 68mm; top: 44mm; font-size: 12px;"></span><!-- æ¥æº -->
																		<span
																			style="position: absolute; left: 40mm; top: 17mm; font-size: 10px;">35.00</span><!-- å·¦|ç¥¨ä»· -->
																		<span
																			style="position: absolute; left: 40mm; top: 20mm; font-size: 10px;">0.00</span><!-- å·¦|æœåŠ¡è´¹ -->
																		<span
																			style="position: absolute; left: 66mm; top: 60mm; font-size: 12px;">35.00</span><!-- å³|ç¥¨ä»· -->
																		<span
																			style="position: absolute; left: 10mm; top: 20mm; font-size: 12px;">å‰å°</span>
																		<span
																			style="position: absolute; left: 34mm; top: 38mm; font-size: 12px;">ç°åœºå”®ç¥¨</span>
																		<span
																			style="position: absolute; left: 33mm; top: 55mm; font-size: 12px;">æ²³å—çœéƒ‘å·å¸‚<br>äºšæ˜Ÿå°é¾™æ¿€å…‰å½±åŸ</span>
																		<div id="qrcode"
																			style="position: absolute; left: 5mm; top: 38mm;">
																		</div><!-- äºŒç»´ç  -->
																	</div>

																	<button onclick="printDiv2()">æ‰“å°</button>

																	<script>
																		const parseBtn = document.getElementById('parseBtn');
																		const jsonInput = document.getElementById('json-input');
																		const resultSelect = document.getElementById('resultSelect');
																		const hallDiv = document.getElementById('hall');
																		const hallDiv2 = document.getElementById('hall2');
																		const nameDiv = document.getElementById('name');
																		const dateDiv = document.getElementById('date');
																		const dateDiv2 = document.getElementById('date2');
																		const timeDiv = document.getElementById('time');
																		const timeDiv2 = document.getElementById('time2');
																		const qrcodeDiv = document.getElementById('qrcode');
																		const rowInput = document.getElementById('rowInput');
																		const seatInput = document.getElementById('seatInput');
																		const rowSpan = document.getElementById('rowSpan');
																		const seatSpan = document.getElementById('seatSpan');
																		const rowSpan2 = document.getElementById('rowSpan2');
																		const seatSpan2 = document.getElementById('seatSpan2');
																		const nowTimeSpan = document.getElementById('nowTime');
																		const sourceSelect = document.getElementById('sourceSelect');
																		const sourceSpan = document.getElementById('sourceSpan');

																		let currentData = [];
																		let currentIndex = 0;

																		// === å®æ—¶æ—¶é—´ ===
																		function updateCurrentTime() {
																			const now = new Date();
																			const Y = now.getFullYear();
																			const M = String(now.getMonth() + 1).padStart(2, '0');
																			const D = String(now.getDate()).padStart(2, '0');
																			const h = String(now.getHours()).padStart(2, '0');
																			const m = String(now.getMinutes()).padStart(2, '0');
																			const s = String(now.getSeconds()).padStart(2, '0');
																			nowTimeSpan.textContent = `${Y}.${M}.${D} ${h}:${m}:${s}`;
																		}
																		setInterval(updateCurrentTime, 1000);
																		updateCurrentTime();

																		// === è§£æJSON ===
																		parseBtn.addEventListener('click', () => {
																			resultSelect.innerHTML = '';
																			clearDisplay();

																			try {
																				const obj = JSON.parse(jsonInput.value.trim());
																				const arr = obj?.data?.arr_date_plan;

																				if (!Array.isArray(arr)) {
																					alert('æœªæ‰¾åˆ° data.arr_date_plan æ•°ç»„ï¼');
																					return;
																				}

																				currentData = arr;
																				arr.forEach((item, index) => {
																					const hall = item.hall_name || '(æ— å½±å…)';
																					const name = item.display_name || '(æ— ç‰‡å)';
																					const time = item.show_time_start || '(æ— æ—¶é—´)';
																					const option = document.createElement('option');
																					option.value = index;
																					option.textContent = `${time.slice(11, 16)} - ${hall} - ${name}`;
																					resultSelect.appendChild(option);
																				});

																				if (arr.length > 0) {
																					resultSelect.selectedIndex = 0;
																					displayInfo(0);
																				}
																			} catch (e) {
																				alert('JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥ï¼\n\né”™è¯¯ä¿¡æ¯ï¼š' + e.message);
																			}
																		});

																		resultSelect.addEventListener('change', (e) => {
																			const index = e.target.value;
																			currentIndex = index;
																			displayInfo(index);
																		});

																		rowInput.addEventListener('input', updateDynamicInfo);
																		seatInput.addEventListener('input', updateDynamicInfo);
																		sourceSelect.addEventListener('change', updateDynamicInfo);

																		function updateDynamicInfo() {
																			rowSpan.textContent = rowInput.value ? `${rowInput.value} æ’` : '';
																			seatSpan.textContent = seatInput.value ? `${seatInput.value} å·` : '';
																			rowSpan2.textContent = rowInput.value ? `${rowInput.value} æ’` : '';
																			seatSpan2.textContent = seatInput.value ? `${seatInput.value} å·` : '';
																			sourceSpan.textContent = sourceSelect.value ? `${sourceSelect.value}` : '';
																			generateQRCode();
																		}

																		function displayInfo(index) {
																			const item = currentData[index];
																			if (!item) return;

																			hallDiv.textContent = item.hall_name || '(æ— å½±å…)';
																			hallDiv2.textContent = hallDiv.textContent;
																			nameDiv.textContent = item.display_name || '(æ— ç‰‡å)';

																			if (item.show_time_start) {
																				const [datePart, timePart] = item.show_time_start.split('T');
																				dateDiv.textContent = datePart.replace(/-/g, '.');
																				dateDiv2.textContent = dateDiv.textContent;
																				timeDiv.textContent = timePart.slice(0, 5);
																				timeDiv2.textContent = timeDiv.textContent;
																			}

																			generateQRCode();
																		}

																		function generateQRCode() {
																			const variablePart =
																				`${hallDiv.textContent}${nameDiv.textContent}` +
																				`${rowInput.value}${seatInput.value}${nowTimeSpan.textContent}`;
																			const encodedPart = btoa(unescape(encodeURIComponent(variablePart)));
																			const qrText = `41018401${encodedPart}`;

																			qrcodeDiv.innerHTML = '';
																			new QRCode(qrcodeDiv, {
																				text: qrText,
																				width: 100,
																				height: 100,
																				colorDark: "#000000",
																				colorLight: "#ffffff"
																			});
																		}

																		function clearDisplay() {
																			hallDiv.textContent = hallDiv2.textContent = '';
																			nameDiv.textContent = '';
																			dateDiv.textContent = dateDiv2.textContent = '';
																			timeDiv.textContent = timeDiv2.textContent = '';
																			rowSpan.textContent = seatSpan.textContent = sourceSpan.textContent = '';
																			rowSpan2.textContent = seatSpan2.textContent = '';
																			qrcodeDiv.innerHTML = '';
																		}

																		// === æ‰“å°å¹¶è‡ªåŠ¨å…³é—­ ===
																		function printDiv2() {
																			var content = document.getElementById("NO3").outerHTML;
																			var printWindow = window.open('', '_blank', 'width=800,height=600');
																			printWindow.document.open();
																			printWindow.document.write(`
			    <html>
			    <head>
			        <title>æ‰“å°</title>
			        <style>
			            html, body { margin: 0; padding: 0; }
			            #NO3 {
			                position: relative;
			                height: 84mm;
			                width: 79mm;
			            }
			            #NO3 span, #NO3 div {
			                position: absolute;
			                font-size: 12px;
			                display: block;
			            }
			            @media print {
			                @page { size: auto; margin: 0; }
			                body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
			            }
			        </style>
			    </head>
			    <body>
			        ${content}
			    </body>
			    </html>
			`);
																			printWindow.document.close();

																			printWindow.onload = function() {
																				printWindow.focus();
																				printWindow.print();
																				setTimeout(() => printWindow.close(), 200);
																			};
																		}
																	</script>


																	<script>
																		const x = document.getElementById('X');
																		const no1 = document.getElementById('NO1');
																		const no2 = document.getElementById('NO2');

																		let toggled = false; // æ˜¯å¦åˆ‡æ¢çŠ¶æ€
																		let inactivityTimer; // 15ç§’æ— æ“ä½œè®¡æ—¶å™¨
																		let countdownTimer; // æ¯ç§’æ›´æ–°å€’è®¡æ—¶
																		let remaining = 15; // å‰©ä½™ç§’æ•°ï¼ˆæ”¹ä¸º15ï¼‰

																		// ç‚¹å‡» X åˆ‡æ¢æ˜¾ç¤º
																		x.addEventListener('click', function() {
																			if (!toggled) {
																				no1.style.display = 'none';
																				no2.style.display = 'block';
																			} else {
																				no1.style.display = 'block';
																				no2.style.display = 'none';
																			}
																			toggled = !toggled;
																		});

																		// æ¢å¤ä¸ºé»˜è®¤çŠ¶æ€
																		function resetToDefault() {
																			no1.style.display = 'block';
																			no2.style.display = 'none';
																			toggled = false;
																			resetInactivityTimer(); // æ¢å¤åé‡æ–°å¼€å§‹è®¡æ—¶
																		}

																		// å¯åŠ¨å€’è®¡æ—¶æ˜¾ç¤º
																		function startCountdown() {
																			clearInterval(countdownTimer);
																			countdownTimer = setInterval(() => {
																				remaining--;
																				if (remaining <= 0) {
																					clearInterval(countdownTimer);
																					resetToDefault();
																				}
																			}, 1000);
																		}

																		// é‡ç½®æ— æ“ä½œè®¡æ—¶
																		function resetInactivityTimer() {
																			clearTimeout(inactivityTimer);
																			clearInterval(countdownTimer);
																			remaining = 15; // æ”¹ä¸º15ç§’
																			startCountdown();
																			inactivityTimer = setTimeout(resetToDefault, 15000); // 15ç§’æ— æ“ä½œåæ¢å¤
																		}

																		// ç›‘å¬æ•´ä¸ªé¡µé¢çš„ç‚¹å‡»äº‹ä»¶
																		document.addEventListener('click', resetInactivityTimer);

																		// é¡µé¢åŠ è½½åå¯åŠ¨
																		resetInactivityTimer();
																	</script>

																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>